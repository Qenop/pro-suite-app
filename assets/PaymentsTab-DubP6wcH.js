import{u as R,r as d,j as e,a as m}from"./index-BOaqYkpz.js";const T=()=>{const{property:n}=R(),[p,I]=d.useState([]),[u,b]=d.useState([]),[y,j]=d.useState(!1),[r,x]=d.useState({tenantId:"",unitId:"",amount:"",date:"",method:"",paymentReference:"",type:"",period:""}),[N,f]=d.useState(!1),[S,g]=d.useState(!1),[o,C]=d.useState({tenantName:"",unitId:"",type:""});d.useEffect(()=>{const t=async()=>{try{const a=await m.get(`/tenants?propertyId=${n._id}`);I(a.data)}catch(a){console.error("Failed to load tenants:",a)}};n!=null&&n._id&&t()},[n]),d.useEffect(()=>{const t=async()=>{g(!0);try{const a=await m.get(`/properties/${n._id}/payments`);b(a.data)}catch(a){console.error("Failed to load payments:",a)}finally{g(!1)}};n!=null&&n._id&&t()},[n]);const P=t=>{const a=t.target.value,s=p.find(l=>l._id===a);x(l=>({...l,tenantId:a,unitId:(s==null?void 0:s.unitId)||""}))},c=t=>{const{name:a,value:s}=t.target;x(l=>{if(a==="date"){const i=s?s.slice(0,7):"";return{...l,date:s,period:i}}return{...l,[a]:s}})},h=t=>{const{name:a,value:s}=t.target;C(l=>({...l,[a]:s}))},D=async t=>{t.preventDefault(),f(!0);try{const a={...r,amount:Number(r.amount),date:new Date(r.date).toISOString(),period:r.period};await m.post(`/properties/${n._id}/payments`,a),alert("Payment recorded successfully"),x({tenantId:"",unitId:"",amount:"",date:"",method:"",paymentReference:"",type:"",period:""});const s=await m.get(`/properties/${n._id}/payments`);b(s.data),j(!1)}catch(a){console.error("Payment submission failed:",a),alert("Error saving payment")}finally{f(!1)}};return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Payments"}),e.jsx("button",{onClick:()=>j(t=>!t),className:"bg-cyan-700 text-white px-4 py-2 rounded hover:bg-black",children:y?"Close Form":"Record Payment"})]}),e.jsx("div",{className:`transition-all duration-500 ease-in-out overflow-hidden ${y?"max-h-[1000px] mb-8":"max-h-0"}`,children:e.jsxs("form",{onSubmit:D,className:"space-y-4 max-w-xl",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Tenant"}),e.jsxs("select",{name:"tenantId",value:r.tenantId,onChange:P,className:"w-full border rounded p-2",required:!0,children:[e.jsx("option",{value:"",children:"Select Tenant"}),p.map(t=>e.jsxs("option",{value:t._id,children:[t.name," (",t.unitId,")"]},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Unit ID"}),e.jsx("input",{type:"text",name:"unitId",value:r.unitId,readOnly:!0,className:"w-full border rounded p-2 bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Amount"}),e.jsx("input",{type:"number",name:"amount",value:r.amount,onChange:c,className:"w-full border rounded p-2",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Date"}),e.jsx("input",{type:"date",name:"date",value:r.date,onChange:c,className:"w-full border rounded p-2",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Payment Type"}),e.jsxs("select",{name:"type",value:r.type,onChange:c,className:"w-full border rounded p-2",required:!0,children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"Rent",children:"Rent"}),e.jsx("option",{value:"Deposit",children:"Deposit"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Payment Method"}),e.jsxs("select",{name:"method",value:r.method,onChange:c,className:"w-full border rounded p-2",required:!0,children:[e.jsx("option",{value:"",children:"Select Method"}),e.jsx("option",{value:"mpesa",children:"Mpesa"}),e.jsx("option",{value:"bank",children:"Bank Transfer"}),e.jsx("option",{value:"cash",children:"Cash"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Payment Reference"}),e.jsx("input",{type:"text",name:"paymentReference",value:r.paymentReference,onChange:c,className:"w-full border rounded p-2",placeholder:"e.g. MPESA CODE / BANK REF"})]}),e.jsx("button",{type:"submit",disabled:N,className:"bg-orange-600 text-white px-4 py-2 rounded hover:bg-red-700",children:N?"Saving...":"Record Payment"})]})}),e.jsxs("div",{className:"mb-4 flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Tenant Name"}),e.jsx("input",{type:"text",name:"tenantName",value:o.tenantName,onChange:h,className:"border rounded p-2 w-48",placeholder:"Search by name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Unit ID"}),e.jsx("input",{type:"text",name:"unitId",value:o.unitId,onChange:h,className:"border rounded p-2 w-36",placeholder:"e.g. A1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Payment Type"}),e.jsxs("select",{name:"type",value:o.type,onChange:h,className:"border rounded p-2 w-36",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"Rent",children:"Rent"}),e.jsx("option",{value:"Deposit",children:"Deposit"})]})]})]}),e.jsxs("div",{className:"mt-4 max-w-4xl",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Payments History"}),S?e.jsx("p",{children:"Loading payments..."}):u.length===0?e.jsx("p",{children:"No payments recorded yet."}):e.jsxs("table",{className:"w-full border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border px-4 py-2 text-left",children:"Date"}),e.jsx("th",{className:"border px-4 py-2 text-left",children:"Tenant"}),e.jsx("th",{className:"border px-4 py-2 text-left",children:"Unit"}),e.jsx("th",{className:"border px-4 py-2 text-left",children:"Period"}),e.jsx("th",{className:"border px-4 py-2 text-right",children:"Amount (KES)"}),e.jsx("th",{className:"border px-4 py-2 text-left",children:"Type"}),e.jsx("th",{className:"border px-4 py-2 text-left",children:"Method"}),e.jsx("th",{className:"border px-4 py-2 text-left",children:"Reference"})]})}),e.jsx("tbody",{children:u.filter(t=>{var i,v,w;const a=(v=(i=t.tenantId)==null?void 0:i.name)==null?void 0:v.toLowerCase().includes(o.tenantName.toLowerCase()),s=(w=t.unitId)==null?void 0:w.toLowerCase().includes(o.unitId.toLowerCase()),l=o.type?t.type===o.type:!0;return a&&s&&l}).map(t=>{var a;return e.jsxs("tr",{className:"even:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:((a=t.tenantId)==null?void 0:a.name)||"N/A"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.unitId}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.period||"-"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2 text-right",children:t.amount.toLocaleString()}),e.jsx("td",{className:"border border-gray-300 px-4 py-2 capitalize",children:t.type||"-"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.method}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.paymentReference||"-"})]},t._id)})})]})]})]})};export{T as default};
