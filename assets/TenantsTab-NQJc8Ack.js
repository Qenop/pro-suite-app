import{r as l,j as e,a as C,u as k,L as R}from"./index-Czh7mnsa.js";const U=({propertyId:o,onTenantAdded:j,onCancel:N})=>{const[d,S]=l.useState(null),[n,h]=l.useState({name:"",phone:"",email:"",idNumber:"",leaseStartDate:"",unitId:"",gender:"",occupation:"",emergencyContactName:"",emergencyContactPhone:"",emergencyContactRelation:"",notes:""}),[w,m]=l.useState(""),[P,f]=l.useState(""),[c,D]=l.useState(null),[x,b]=l.useState(!0),[v,i]=l.useState("");l.useEffect(()=>{o&&(async()=>{b(!0);try{const s=await C.get(`/properties/${o}`);S(s.data)}catch{i("Failed to load property data.")}finally{b(!1)}})()},[o]);const t=d!=null&&d.units?d.units.flatMap(a=>a.unitIds.filter(s=>s.status.toLowerCase()==="vacant").map(s=>({_id:s._id,unitId:s.unitId,type:a.type,rent:a.rent,deposit:a.deposit}))):[],r=a=>{h(s=>({...s,[a.target.name]:a.target.value}))},g=a=>{const s=a.target.value;h(p=>({...p,unitId:s}));const y=t.find(p=>p.unitId===s);y?(m(y.rent),f(y.deposit)):(m(""),f(""))},F=a=>{D(a.target.files[0])},L=async a=>{var p,I;a.preventDefault(),i("");const s=new FormData;for(const u in n)u.startsWith("emergencyContact")||s.append(u,n[u]);s.append("propertyId",o),s.append("rent",w),s.append("deposit",P);const y={name:n.emergencyContactName,phone:n.emergencyContactPhone,relation:n.emergencyContactRelation};s.append("emergencyContact",JSON.stringify(y)),c&&s.append("profilePicture",c);try{await C.post("/tenants",s,{headers:{"Content-Type":"multipart/form-data"}}),j()}catch(u){(I=(p=u.response)==null?void 0:p.data)!=null&&I.message?i(u.response.data.message):i("Failed to add tenant. Please try again.")}};return x?e.jsx("p",{children:"Loading property data..."}):e.jsxs("form",{onSubmit:L,className:"space-y-6 p-4 bg-white shadow rounded-md",children:[v&&e.jsx("p",{className:"text-red-600",children:v}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",name:"name",placeholder:"Full Name",value:n.name,onChange:r,required:!0,className:"input"}),e.jsx("input",{type:"tel",name:"phone",placeholder:"Phone Number",value:n.phone,onChange:r,required:!0,className:"input"}),e.jsx("input",{type:"email",name:"email",placeholder:"Email",value:n.email,onChange:r,className:"input"}),e.jsx("input",{type:"text",name:"idNumber",placeholder:"ID Number",value:n.idNumber,onChange:r,required:!0,className:"input"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"leaseStartDate",className:"text-sm text-gray-700 mb-1",children:"Lease Start Date"}),e.jsx("input",{type:"date",name:"leaseStartDate",id:"leaseStartDate",value:n.leaseStartDate,onChange:r,required:!0,className:"input"})]}),e.jsxs("select",{name:"unitId",value:n.unitId,onChange:g,required:!0,className:"input",children:[e.jsx("option",{value:"",children:"Select Unit"}),t.sort((a,s)=>a.unitId.localeCompare(s.unitId)).map(a=>e.jsxs("option",{value:a.unitId,children:[a.unitId," (",a.type,") - Rent: ",a.rent]},a._id))]}),e.jsxs("select",{name:"gender",value:n.gender,onChange:r,required:!0,className:"input",children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Other",children:"Other"})]}),e.jsx("input",{type:"text",name:"occupation",placeholder:"Occupation",value:n.occupation,onChange:r,className:"input"})]}),e.jsxs("fieldset",{className:"border border-gray-200 p-4 rounded",children:[e.jsx("legend",{className:"text-sm font-medium text-gray-700 mb-2",children:"Emergency Contact"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("input",{type:"text",name:"emergencyContactName",placeholder:"Name",value:n.emergencyContactName,onChange:r,className:"input"}),e.jsx("input",{type:"tel",name:"emergencyContactPhone",placeholder:"Phone",value:n.emergencyContactPhone,onChange:r,className:"input"}),e.jsx("input",{type:"text",name:"emergencyContactRelation",placeholder:"Relation",value:n.emergencyContactRelation,onChange:r,className:"input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Profile Picture"}),e.jsx("input",{type:"file",name:"profilePicture",accept:"image/*",onChange:F,className:"input"}),c&&e.jsx("img",{src:URL.createObjectURL(c),alt:"Profile Preview",className:"w-20 h-20 rounded-full mt-2"})]}),e.jsx("div",{children:e.jsx("textarea",{name:"notes",placeholder:"Additional notes about the tenant...",value:n.notes,onChange:r,rows:3,className:"input w-full"})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Add Tenant"}),e.jsx("button",{type:"button",onClick:N,className:"bg-gray-300 px-4 py-2 rounded",children:"Cancel"})]})]})},T=()=>{const{property:o}=k(),[j,N]=l.useState([]),[d,S]=l.useState(!0),[n,h]=l.useState(""),[w,m]=l.useState(!1),[P,f]=l.useState(!1),[c,D]=l.useState(""),[x,b]=l.useState("");l.useEffect(()=>{(async()=>{try{const r=await C.get(`/tenants?propertyId=${o._id}`);N(r.data),h("")}catch(r){console.error("Failed to fetch tenants:",r),h("Failed to load tenants for this property.")}finally{S(!1)}})()},[o._id,P]);const v=async t=>{if(window.confirm("Are you sure you want to delete this tenant?"))try{await C.delete(`/tenants/${t}`),N(g=>g.filter(F=>F._id!==t))}catch(g){console.error("Error deleting tenant:",g),alert("Failed to delete tenant. See console for details.")}},i=j.filter(t=>c?t.name.toLowerCase().includes(c.toLowerCase()):!0).filter(t=>x?t.unitId===x:!0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xl font-semibold",children:["Tenants Assigned to ",o==null?void 0:o.propertyName]}),e.jsx("button",{className:"bg-cyan-700 text-white px-4 py-2 rounded hover:bg-black",onClick:()=>m(!0),children:"Add Tenant"})]}),w&&e.jsx("div",{className:"mt-4 p-4 border rounded bg-gray-50",children:e.jsx(U,{propertyId:o._id,onTenantAdded:()=>{m(!1),f(t=>!t)},onCancel:()=>m(!1)})}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-end mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-800",children:"Search by Name"}),e.jsx("input",{type:"text",value:c,onChange:t=>D(t.target.value),placeholder:"e.g. John",className:"mt-1 block w-48 border border-gray-300 rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-800",children:"Filter by Unit ID"}),e.jsxs("select",{value:x,onChange:t=>b(t.target.value),className:"mt-1 block w-40 border border-gray-300 rounded px-2 py-1",children:[e.jsx("option",{value:"",children:"All Units"}),[...new Set(j.map(t=>t.unitId))].map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),d?e.jsx("p",{children:"Loading tenants..."}):n?e.jsx("p",{className:"text-red-600",children:n}):i.length===0?e.jsx("p",{children:"No tenants match your filters."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border border-gray-300",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 border",children:"Name"}),e.jsx("th",{className:"px-4 py-2 border",children:"Unit"}),e.jsx("th",{className:"px-4 py-2 border",children:"Phone"}),e.jsx("th",{className:"px-4 py-2 border",children:"Email"}),e.jsx("th",{className:"px-4 py-2 border",children:"ID Number"}),e.jsx("th",{className:"px-4 py-2 border",children:"Lease Start"}),e.jsx("th",{className:"px-4 py-2 border",children:"Actions"})]})}),e.jsx("tbody",{children:i.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"border px-4 py-2",children:t.name}),e.jsx("td",{className:"border px-4 py-2",children:t.unitId}),e.jsx("td",{className:"border px-4 py-2",children:t.phone}),e.jsx("td",{className:"border px-4 py-2",children:t.email}),e.jsx("td",{className:"border px-4 py-2",children:t.idNumber}),e.jsx("td",{className:"border px-4 py-2",children:new Date(t.leaseStartDate).toLocaleDateString()}),e.jsxs("td",{className:"border px-4 py-2 space-x-2",children:[e.jsx(R,{to:`/tenants/${t._id}`,className:"text-blue-600 hover:underline",children:"View Profile"}),e.jsx("button",{className:"text-red-600 hover:underline",onClick:()=>v(t._id),children:"Delete"})]})]},t._id))})]})})]})};export{T as default};
